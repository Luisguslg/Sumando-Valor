@using Microsoft.AspNetCore.Identity
@inject UserManager<SumandoValor.Infrastructure.Data.ApplicationUser> UserManager
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Sumando Valor | Fundación KPMG Venezuela</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Plataforma de formación y voluntariado de la Fundación KPMG Venezuela. Sumando Valor a través de talleres y programas de desarrollo." />
    <meta name="keywords" content="KPMG, Fundación, Venezuela, Voluntariado, Talleres, Capacitación, Sumando Valor" />
    
    <!-- Bootstrap 5 CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
    
    <!-- Custom KPMG Theme -->
    <link href="~/theme/theme.css" rel="stylesheet" />
    <link href="~/css/public.css" rel="stylesheet" asp-append-version="true" />
    
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/SumandoValor.Web.styles.css" asp-append-version="true" />
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-kpmg sticky-top" role="navigation" aria-label="Navegación principal">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" asp-area="" asp-page="/Index" aria-label="Sumando Valor - Inicio">
                <img src="~/images/logo-fundacion-azul.png" alt="Fundación KPMG Venezuela" style="height: 50px; margin-right: 12px;" onerror="this.style.display='none';" />
                <div>
                    <div style="font-weight: 700; font-size: 1.25rem; line-height: 1;">Sumando Valor</div>
                    <small style="font-size: 0.75rem; color: var(--text-secondary);">Fundación KPMG Venezuela</small>
                </div>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-lg-center">
                    <li class="nav-item">
                        <a class="nav-link @(ViewContext.RouteData.Values["page"]?.ToString() == "/Index" || Context.Request.Path == "/" ? "active" : "")" 
                           asp-area="" asp-page="/Index" 
                           aria-label="Inicio"
                           aria-current="@(ViewContext.RouteData.Values["page"]?.ToString() == "/Index" || Context.Request.Path == "/" ? "page" : "false")">
                            <i class="bi bi-house-fill me-1"></i>Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(Context.Request.Path.StartsWithSegments("/Cursos") ? "active" : "")" 
                           asp-area="" asp-page="/Cursos" 
                           aria-label="Programa formativo"
                           aria-current="@(Context.Request.Path.StartsWithSegments("/Cursos") ? "page" : "false")">
                            <i class="bi bi-calendar-check me-1"></i>Programa formativo
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(Context.Request.Path.StartsWithSegments("/About") ? "active" : "")" 
                           asp-area="" asp-page="/About" 
                           aria-label="Conócenos"
                           aria-current="@(Context.Request.Path.StartsWithSegments("/About") ? "page" : "false")">
                            <i class="bi bi-people-fill me-1"></i>Conócenos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(Context.Request.Path.StartsWithSegments("/Contact") ? "active" : "")" 
                           asp-area="" asp-page="/Contact" 
                           aria-label="Contacto"
                           aria-current="@(Context.Request.Path.StartsWithSegments("/Contact") ? "page" : "false")">
                            <i class="bi bi-envelope-fill me-1"></i>Contacto
                        </a>
                    </li>
                    
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        var currentUser = await UserManager.GetUserAsync(User);
                        string displayName = "Usuario";
                        
                        if (currentUser != null)
                        {
                            var nombres = (currentUser.Nombres?.Trim() ?? string.Empty);
                            var apellidos = (currentUser.Apellidos?.Trim() ?? string.Empty);
                            
                            if (!string.IsNullOrWhiteSpace(nombres) && !string.IsNullOrWhiteSpace(apellidos))
                            {
                                if (nombres.Equals(apellidos, StringComparison.OrdinalIgnoreCase))
                                {
                                    displayName = nombres;
                                }
                                else
                                {
                                    displayName = $"{nombres} {apellidos}";
                                }
                            }
                            else if (!string.IsNullOrWhiteSpace(nombres))
                            {
                                var nombreParts = nombres.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
                                if (nombreParts.Length > 1 && nombreParts[0].Equals(nombreParts[1], StringComparison.OrdinalIgnoreCase))
                                {
                                    displayName = nombreParts[0];
                                }
                                else
                                {
                                    displayName = nombres;
                                }
                            }
                            else if (!string.IsNullOrWhiteSpace(apellidos))
                            {
                                var apellidoParts = apellidos.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
                                if (apellidoParts.Length > 1 && apellidoParts[0].Equals(apellidoParts[1], StringComparison.OrdinalIgnoreCase))
                                {
                                    displayName = apellidoParts[0];
                                }
                                else
                                {
                                    displayName = apellidos;
                                }
                            }
                            else if (!string.IsNullOrWhiteSpace(currentUser.Email))
                            {
                                displayName = currentUser.Email;
                            }
                        }
                        else if (!string.IsNullOrWhiteSpace(User.Identity?.Name))
                        {
                            displayName = User.Identity.Name;
                        }
                        
                        @if (User.IsInRole("Admin"))
                        {
                            <li class="nav-item">
                                <a class="nav-link @(Context.Request.Path.StartsWithSegments("/Admin") ? "active" : "")" 
                                   asp-area="" asp-page="/Admin" 
                                   aria-label="Panel de administración">
                                    <i class="bi bi-gear-fill me-1"></i>Admin
                                </a>
                            </li>
                        }
                        @if (User.IsInRole("Beneficiario"))
                        {
                            <li class="nav-item">
                                <a class="nav-link @(Context.Request.Path.StartsWithSegments("/Profile/Talleres") ? "active" : "")"
                                   asp-area="" asp-page="/Profile/Talleres"
                                   aria-label="Mis talleres">
                                    <i class="bi bi-calendar2-check me-1"></i>Mis Talleres
                                </a>
                            </li>
                        }
                        <li class="nav-item">
                            <a class="nav-link @(Context.Request.Path.StartsWithSegments("/Profile") ? "active" : "")" 
                               asp-area="" asp-page="/Profile" 
                               aria-label="Mi perfil">
                                <i class="bi bi-person-circle me-1"></i>Mi Perfil
                            </a>
                        </li>
                        <li class="nav-item ms-lg-2">
                            <form method="post" asp-page="/Account/Logout" class="d-inline">
                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                    <i class="bi bi-box-arrow-right me-1"></i>Salir
                                </button>
                            </form>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item ms-lg-2">
                            <a asp-area="" asp-page="/Account/Login" class="btn btn-outline-primary btn-sm">
                                Iniciar Sesión
                            </a>
                        </li>
                        <li class="nav-item ms-2">
                            <a asp-area="" asp-page="/Account/Register" class="btn btn-primary btn-sm">
                                <i class="bi bi-person-plus-fill me-1"></i>Registrarse
                            </a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container mt-3">
        <partial name="_Flash" />
    </div>

    <!-- Main Content -->
    <main role="main">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="footer-kpmg mt-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4 mb-3">
                    <div class="d-flex align-items-center mb-3">
                        <img src="~/images/logo-fundacion-blanco.png" alt="Fundación KPMG Venezuela" style="height: 50px; margin-right: 12px;" onerror="this.style.display='none';" />
                        <h5 class="fw-bold mb-0 text-white">Sumando Valor</h5>
                    </div>
                    <p class="text-white-50">
                        Plataforma de formación y desarrollo de la Fundación KPMG Venezuela. 
                        Trabajamos para sumar valor a nuestra comunidad a través de la educación y el voluntariado.
                    </p>
                </div>
                
                <div class="col-md-2 mb-3">
                    <h6 class="fw-bold mb-3 text-white">Enlaces</h6>
                    <ul class="list-unstyled">
                        <li><a asp-area="" asp-page="/Index" class="text-white-50 text-decoration-none d-block mb-2 hover-white">Inicio</a></li>
                        <li><a asp-area="" asp-page="/Cursos" class="text-white-50 text-decoration-none d-block mb-2 hover-white">Programa formativo</a></li>
                        <li><a asp-area="" asp-page="/About" class="text-white-50 text-decoration-none d-block mb-2 hover-white">Conócenos</a></li>
                        <li><a asp-area="" asp-page="/Contact" class="text-white-50 text-decoration-none d-block hover-white">Contacto</a></li>
                    </ul>
                </div>
                
                <div class="col-md-3 mb-3">
                    <h6 class="fw-bold mb-3 text-white">Programas</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <span class="text-white-50">Sumando Valor</span>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <span class="text-white-50">Deja Tu Huella</span>
                        </li>
                    </ul>
                </div>
                
                <div class="col-md-3 mb-3">
                    <h6 class="fw-bold mb-3 text-white">Contacto</h6>
                    <p class="text-white-50 mb-2">
                        <i class="bi bi-envelope-fill me-2"></i>
                        <a class="text-white-50 text-decoration-none hover-white"
                           href="mailto:fundacionkpmg@kpmg.com">
                            fundacionkpmg@kpmg.com
                        </a>
                    </p>
                    <p class="text-white-50 mb-3">
                        <i class="bi bi-geo-alt-fill me-2"></i>
                        Caracas, Venezuela
                    </p>
                    <div class="d-flex gap-3">
                        <a href="https://www.facebook.com/KPMGVE/?locale=es_LA"
                           class="text-white fs-4"
                           aria-label="Facebook"
                           title="Facebook"
                           target="_blank"
                           rel="noopener noreferrer">
                            <i class="bi bi-facebook"></i>
                        </a>
                        <a href="https://www.instagram.com/kpmg_ve/?hl=es"
                           class="text-white fs-4"
                           aria-label="Instagram"
                           title="Instagram"
                           target="_blank"
                           rel="noopener noreferrer">
                            <i class="bi bi-instagram"></i>
                        </a>
                        <a href="https://www.linkedin.com/company/kpmg-venezuela?originalSubdomain=ve"
                           class="text-white fs-4"
                           aria-label="LinkedIn"
                           title="LinkedIn"
                           target="_blank"
                           rel="noopener noreferrer">
                            <i class="bi bi-linkedin"></i>
                        </a>
                        <a href="https://x.com/KPMG_VE"
                           class="text-white fs-4"
                           aria-label="X"
                           title="X"
                           target="_blank"
                           rel="noopener noreferrer">
                            <i class="bi bi-twitter"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <hr class="border-white-50 my-4" />
            
            <div class="row align-items-center">
                <div class="col-md-4 mb-3 mb-md-0">
                    <img src="~/images/logo-fundacion-blanco.png" alt="Fundación KPMG Venezuela" style="height: 60px;" onerror="this.style.display='none';" />
                </div>
                <div class="col-md-8 text-center text-md-end">
                    <small class="text-white-50 d-block mb-2">
                        © 2026 Fundación KPMG Venezuela, Fundación sin fines de lucro, creada por Ostos Velázquez & Asociados y sus firmas relacionadas. Ostos Velázquez & Asociados, una sociedad venezolana y firma miembro de la organización global de KPMG de firmas miembro independientes afiliadas a KPMG International Ltd., una entidad privada.
                    </small>
                    <small class="text-white-50">
                        <a href="https://kpmg.com/ve/es/home.html" class="text-white-50 text-decoration-none me-3 hover-white" target="_blank" rel="noopener noreferrer">Términos de Uso</a>
                        <a href="https://kpmg.com/ve/es/home/about/privacidad.html" class="text-white-50 text-decoration-none hover-white" target="_blank" rel="noopener noreferrer">Política de Privacidad</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
