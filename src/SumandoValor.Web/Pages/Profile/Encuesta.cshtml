@page
@model SumandoValor.Web.Pages.Profile.EncuestaModel
@using SumandoValor.Domain.Entities.Surveys
@{
    ViewData["Title"] = "Encuesta";
}

@await Html.PartialAsync("_PageHeader", new SumandoValor.Web.Pages.Shared.PageHeaderModel
{
    Title = "Encuesta de satisfacción",
    Subtitle = "Ayúdanos a mejorar compartiendo tu opinión.",
    UseBrandBackground = false
})

<div class="container my-5">
    @if (Model.Template == null || Model.Taller == null)
    {
        <div class="alert alert-warning">Encuesta no disponible.</div>
        <a asp-page="/Profile/Talleres" class="btn btn-outline-secondary">Volver</a>
    }
    else
    {
        <div class="card card-kpmg">
            <div class="card-body p-4 p-lg-5">
                <div class="mb-3">
                    <div class="text-muted small">Taller</div>
                    <div class="fw-bold">@Model.Taller.Titulo</div>
                </div>

                <form method="post">
                    <input type="hidden" asp-for="TallerId" />
                    <input type="hidden" asp-for="TemplateId" />

                    @foreach (var q in Model.Questions)
                    {
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                @q.Text
                                @if (q.IsRequired)
                                {
                                    <span class="text-danger">*</span>
                                }
                            </label>

                            @if (q.Type == SurveyQuestionType.Rating1To5)
                            {
                                <div class="d-flex flex-wrap gap-2">
                                    @for (int r = 1; r <= 5; r++)
                                    {
                                        var id = $"q_{q.Id}_{r}";
                                        <div class="form-check form-check-inline m-0">
                                            <input class="form-check-input"
                                                   type="radio"
                                                   name="Answers[@q.Id]"
                                                   id="@id"
                                                   value="@r"
                                                   @(q.IsRequired ? "required" : "") />
                                            <label class="form-check-label" for="@id">@r</label>
                                        </div>
                                    }
                                </div>
                            }
                            else if (q.Type == SurveyQuestionType.Text)
                            {
                                <textarea class="form-control"
                                          name="Answers[@q.Id]"
                                          rows="3"
                                          maxlength="2000"
                                          @(q.IsRequired ? "required" : "")></textarea>
                            }
                            else if (q.Type == SurveyQuestionType.SingleChoice)
                            {
                                <div class="d-grid gap-2">
                                    @foreach (var opt in q.Options)
                                    {
                                        var id = $"q_{q.Id}_{opt.GetHashCode()}";
                                        <div class="form-check m-0">
                                            <input class="form-check-input"
                                                   type="radio"
                                                   name="Answers[@q.Id]"
                                                   id="@id"
                                                   value="@opt"
                                                   @(q.IsRequired ? "required" : "") />
                                            <label class="form-check-label" for="@id">@opt</label>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Enviar encuesta</button>
                        <a asp-page="/Profile/Talleres" class="btn btn-outline-secondary">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    }
</div>

